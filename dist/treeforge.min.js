!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TreeForge={})}(this,function(e){"use strict";function t(e,t){if(!t)return{children:e};const n=t.split("/");let o={children:e};for(const e of n)if(o=(o.children||[]).find(t=>t.name===e),!o)return null;return o}function n(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function o(e,t,i="",s=""){if(!e)return"";const a=(t.asciiStyle,{branch:" ",last:" ",pipe:" "});let r="";return e.forEach((l,d)=>{const c=d===e.length-1,f=c?a.last:a.branch,h=t.icons[l.type],u=function(e,t){return e?`${e}/${t}`:t}(s,l.name);if(r+=`<div class="tf-node" data-path="${n(u)}">\n\t\t<div class="tf-node-name">${i}${f}${h} <span class="tf-name-text">${n(l.name)}</span></div>\n\t\t<span class="tf-action"> ⋮  </span>\n\t\t</div>`,"folder"===l.type&&!l.collapsed&&l.children){const e=i+(c?" ":a.pipe);r+=o(l.children,t,e,u)}}),r}class i{constructor(e){if(this.container=document.getElementById(e.containerId),!this.container)throw new Error("Invalid containerId");if(this.data=e.localData||[],this.mode=e.localData?"local":"api",this.currentFile=null,this.fileContents={},this.unsavedChanges=new Set,this.editorConfig={inputId:e.editorInputId||null,filenameId:e.editorFilenameId||null,saveButtonId:e.editorSaveButtonId||null,closeButtonId:e.editorCloseButtonId||null,unsavedIndicatorId:e.editorUnsavedIndicatorId||null,containerId:e.editorContainerId||null,useBuiltIn:!e.editorInputId},this.onFileOpen=e.onFileOpen||(()=>{}),this.settings=Object.assign({asciiStyle:"unicode",indent:2,colors:{folder:"cyan",file:"white"},icons:{folder:"📁",file:"📄"}},e.settings||{}),this.hooks=e.hooks||{},this.onLoad=e.onLoad||null,"api"===this.mode&&"function"!=typeof this.onLoad)throw new Error("API mode requires onLoad function");this._buildToolbar(),this._buildModal(),this._buildContextMenu(),this._buildContentEditor(),this.refresh()}_getUniqueName(e,t){const n=e.children||[];if(!n.some(e=>e.name===t))return t;const o=t.lastIndexOf(".");let i,s;o>0&&o<t.length-1?(i=t.substring(0,o),s=t.substring(o)):(i=t,s="");let a,r=1;do{a=`${i}(${r})${s}`,r++}while(n.some(e=>e.name===a));return a}async createFile(e,n){if(!n)return!1;if("api"===this.mode){const t=await(this.hooks.onCreateFile?.(e,n));return t&&await this.refresh(),t}const o=t(this.data,e)||{children:this.data};if(!o||o.type&&"folder"!==o.type)return!1;const i=this._getUniqueName(o,n);return o.children=o.children||[],o.children.push({name:i,type:"file"}),this.refresh(),!0}async createFolder(e,n){if(!n)return!1;if("api"===this.mode){const t=await(this.hooks.onCreateFolder?.(e,n));return t&&await this.refresh(),t}const o=t(this.data,e)||{children:this.data};if(!o||o.type&&"folder"!==o.type)return!1;const i=this._getUniqueName(o,n);return o.children=o.children||[],o.children.push({name:i,type:"folder",children:[]}),this.refresh(),!0}async deleteNode(e){const n=t(this.data,e);if(!n)return!1;if(this.settings.deleteConfirm){if(!this.settings.deleteConfirm(n.name))return!1}else{if(!await this._showConfirmModal(`Delete "${n.name}"?`))return!1}if("api"===this.mode){let t;return"folder"===n.type?(t=await(this.hooks.onDeleteFolder?.(e,n)),void 0===t&&(t=await(this.hooks.onDeleteNode?.(e,n)))):(t=await(this.hooks.onDeleteFile?.(e,n)),void 0===t&&(t=await(this.hooks.onDeleteNode?.(e,n)))),t&&await this.refresh(),t}const o=e.split("/"),i=o.pop(),s=t(this.data,o.join("/"));return!(!s||!s.children)&&(s.children=s.children.filter(e=>e.name!==i),this.refresh(),!0)}async renameNode(e,n){const o=t(this.data,e);if(!o)return!1;if(!n&&this.settings.renamePrompt&&(n=this.settings.renamePrompt(o.name)),!n)return!1;if("api"===this.mode){const t=await(this.hooks.onRenameNode?.(e,n));return t&&await this.refresh(),t}return o.name=n,this.refresh(),!0}_buildToolbar(){const e=document.createElement("div");e.className="tf-toolbar",e.innerHTML='<button class="tf-btn" data-action="new-file">\n\t\t<svg width="64px" height="64px" viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#ffffff" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0">\n\t\t</g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>\n\t\t<g id="SVGRepo_iconCarrier">\n\t\t<title>file_new_line</title>\n\t\t<g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> \n\t\t<g id="File" transform="translate(-336.000000, -96.000000)" fill-rule="nonzero"> \n\t\t<g id="file_new_line" transform="translate(336.000000, 96.000000)">\n\t\t<path d="M24,0 L24,24 L0,24 L0,0 L24,0 Z M12.5934901,23.257841 L12.5819402,23.2595131 L12.5108777,23.2950439 L12.4918791,23.2987469 L12.4918791,23.2987469 L12.4767152,23.2950439 L12.4056548,23.2595131 C12.3958229,23.2563662 12.3870493,23.2590235 12.3821421,23.2649074 L12.3780323,23.275831 L12.360941,23.7031097 L12.3658947,23.7234994 L12.3769048,23.7357139 L12.4804777,23.8096931 L12.4953491,23.8136134 L12.4953491,23.8136134 L12.5071152,23.8096931 L12.6106902,23.7357139 L12.6232938,23.7196733 L12.6232938,23.7196733 L12.6266527,23.7031097 L12.609561,23.275831 C12.6075724,23.2657013 12.6010112,23.2592993 12.5934901,23.257841 L12.5934901,23.257841 Z M12.8583906,23.1452862 L12.8445485,23.1473072 L12.6598443,23.2396597 L12.6498822,23.2499052 L12.6498822,23.2499052 L12.6471943,23.2611114 L12.6650943,23.6906389 L12.6699349,23.7034178 L12.6699349,23.7034178 L12.678386,23.7104931 L12.8793402,23.8032389 C12.8914285,23.8068999 12.9022333,23.8029875 12.9078286,23.7952264 L12.9118235,23.7811639 L12.8776777,23.1665331 C12.8752882,23.1545897 12.8674102,23.1470016 12.8583906,23.1452862 L12.8583906,23.1452862 Z M12.1430473,23.1473072 C12.1332178,23.1423925 12.1221763,23.1452606 12.1156365,23.1525954 L12.1099173,23.1665331 L12.0757714,23.7811639 C12.0751323,23.7926639 12.0828099,23.8018602 12.0926481,23.8045676 L12.108256,23.8032389 L12.3092106,23.7104931 L12.3186497,23.7024347 L12.3186497,23.7024347 L12.3225043,23.6906389 L12.340401,23.2611114 L12.337245,23.2485176 L12.337245,23.2485176 L12.3277531,23.2396597 L12.1430473,23.1473072 Z" id="MingCute" fill-rule="nonzero">\n\t\t</path> <path d="M13.5858,2 C14.0572667,2 14.5115877,2.16648691 14.870172,2.46691468 L15,2.58579 L19.4142,7 C19.7476222,7.33339556 19.9511481,7.77238321 19.9922598,8.23835797 L20,8.41421 L20,20 C20,21.0543909 19.18415,21.9181678 18.1492661,21.9945144 L18,22 L6,22 C4.94563773,22 4.08183483,21.18415 4.00548573,20.1492661 L4,20 L4,4 C4,2.94563773 4.81587733,2.08183483 5.85073759,2.00548573 L6,2 L13.5858,2 Z M12,4 L6,4 L6,20 L18,20 L18,10 L13.5,10 C12.6716,10 12,9.32843 12,8.5 L12,4 Z M12,11.5 C12.5523,11.5 13,11.9477 13,12.5 L13,14 L14.5,14 C15.0523,14 15.5,14.4477 15.5,15 C15.5,15.5523 15.0523,16 14.5,16 L13,16 L13,17.5 C13,18.0523 12.5523,18.5 12,18.5 C11.4477,18.5 11,18.0523 11,17.5 L11,16 L9.5,16 C8.94772,16 8.5,15.5523 8.5,15 C8.5,14.4477 8.94772,14 9.5,14 L11,14 L11,12.5 C11,11.9477 11.4477,11.5 12,11.5 Z M14,4.41421 L14,8 L17.5858,8 L14,4.41421 Z" id="形状" fill="#fff"> </path> </g> </g> </g> </g></svg></button>\n\t\t\t<button class="tf-btn" data-action="new-folder"><svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M12.0601 16.5V11.5" stroke="#fff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M14.5 14H9.5" stroke="#fff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M22 11V17C22 21 21 22 17 22H7C3 22 2 21 2 17V7C2 3 3 2 7 2H8.5C10 2 10.33 2.44 10.9 3.2L12.4 5.2C12.78 5.7 13 6 14 6H17C21 6 22 7 22 11Z" stroke="#fff" stroke-width="1.5" stroke-miterlimit="10"></path> </g></svg></button>\n\t\t\t<button class="tf-btn" data-action="collapse-all"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M9 9H4v1h5V9z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M5 3l1-1h7l1 1v7l-1 1h-2v2l-1 1H3l-1-1V6l1-1h2V3zm1 2h4l1 1v4h2V3H6v2zm4 1H3v7h7V6z"></path></g></svg></button>\n\t\t\t<button class="tf-btn" data-action="refresh"><svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M11 2L13 3.99545L12.9408 4.05474M13 18.0001L11 19.9108L11.0297 19.9417M12.9408 4.05474L11 6M12.9408 4.05474C12.6323 4.01859 12.3183 4 12 4C7.58172 4 4 7.58172 4 12C4 14.5264 5.17107 16.7793 7 18.2454M17 5.75463C18.8289 7.22075 20 9.47362 20 12C20 16.4183 16.4183 20 12 20C11.6716 20 11.3477 19.9802 11.0297 19.9417M13 22.0001L11.0297 19.9417" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t</g>\n\t\t\t</svg>\n\t\t\t</button>',this.container.insertBefore(e,this.container.firstChild),e.addEventListener("click",async e=>{switch(e.target.dataset.action){case"new-file":{const e=await this._showInputModal("Create New File","Enter file name...","newFile.js");e&&await this.createFile("",e);break}case"new-folder":{const e=await this._showInputModal("Create New Folder","Enter folder name...","newFolder");e&&await this.createFolder("",e);break}case"collapse-all":this._setAllCollapsed(!0),this.refresh();break;case"refresh":this.refresh()}})}_setAllCollapsed(e){!function t(n){(n||[]).forEach(n=>{"folder"===n.type&&(n.collapsed=e,t(n.children))})}(this.data)}_buildContentEditor(){if(this.editorConfig.useBuiltIn)this._editorPanel=document.createElement("div"),this._editorPanel.className="tf-content-editor",this._editorPanel.style.display="none",this._editorPanel.innerHTML='\n\t\t\t\t<div class="tf-editor-header">\n\t\t\t\t\t<div class="tf-editor-title">\n\t\t\t\t\t\t<span class="tf-editor-filename">No file selected</span>\n\t\t\t\t\t\t<span class="tf-editor-unsaved" style="display: none;">●</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tf-editor-actions">\n\t\t\t\t\t\t<button class="tf-btn" data-action="save">Save</button>\n\t\t\t\t\t\t<button class="tf-btn" data-action="close">Close</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tf-editor-body">\n\t\t\t\t\t<textarea class="tf-editor-textarea" placeholder="File content will appear here..."></textarea>\n\t\t\t\t</div>\n\t\t\t',this.container.parentElement.appendChild(this._editorPanel),this._editorElements={input:this._editorPanel.querySelector(".tf-editor-textarea"),filename:this._editorPanel.querySelector(".tf-editor-filename"),saveBtn:this._editorPanel.querySelector('[data-action="save"]'),closeBtn:this._editorPanel.querySelector('[data-action="close"]'),unsavedIndicator:this._editorPanel.querySelector(".tf-editor-unsaved"),container:this._editorPanel};else if(this._editorElements={input:document.getElementById(this.editorConfig.inputId),filename:this.editorConfig.filenameId?document.getElementById(this.editorConfig.filenameId):null,saveBtn:this.editorConfig.saveButtonId?document.getElementById(this.editorConfig.saveButtonId):null,closeBtn:this.editorConfig.closeButtonId?document.getElementById(this.editorConfig.closeButtonId):null,unsavedIndicator:this.editorConfig.unsavedIndicatorId?document.getElementById(this.editorConfig.unsavedIndicatorId):null,container:this.editorConfig.containerId?document.getElementById(this.editorConfig.containerId):null},!this._editorElements.input)throw new Error(`Editor input element with id "${this.editorConfig.inputId}" not found`);const{input:e,saveBtn:t,closeBtn:n,unsavedIndicator:o}=this._editorElements;e.addEventListener("input",()=>{this.currentFile&&(this.unsavedChanges.add(this.currentFile),o&&(o.style.display="inline"))}),t&&t.addEventListener("click",async()=>{this.currentFile&&await this._saveFileContent(this.currentFile,e.value)}),n&&n.addEventListener("click",async()=>{if(this.currentFile&&this.unsavedChanges.has(this.currentFile)){if(!await this._showConfirmModal("You have unsaved changes. Close anyway?"))return}this._closeEditor()}),e.addEventListener("keydown",async t=>{(t.ctrlKey||t.metaKey)&&"s"===t.key&&(t.preventDefault(),this.currentFile&&await this._saveFileContent(this.currentFile,e.value))})}_buildModal(){this._modal=document.createElement("div"),this._modal.className="tf-modal",this._modal.style.display="none",this._modal.innerHTML='\n\t\t\t<div class="tf-modal-backdrop"></div>\n\t\t\t<div class="tf-modal-body">\n\t\t\t\t<div class="tf-modal-header"></div>\n\t\t\t\t<div class="tf-modal-message"></div>\n\t\t\t\t<div class="tf-modal-input-wrapper" style="display: none;">\n\t\t\t\t\t<input type="text" class="tf-modal-input" placeholder="Enter name..." />\n\t\t\t\t</div>\n\t\t\t\t<div class="tf-modal-actions">\n\t\t\t\t\t<button data-cancel>Cancel</button>\n\t\t\t\t\t<button data-ok>OK</button>\n\t\t\t\t</div>\n\t\t\t</div>',document.body.appendChild(this._modal);const e=this._modal.querySelector("[data-cancel]"),t=this._modal.querySelector("[data-ok]"),n=this._modal.querySelector(".tf-modal-input");e.addEventListener("click",()=>this._hideModal(null)),t.addEventListener("click",()=>{"input"===this._modalMode?this._hideModal(n.value.trim()):this._hideModal(!0)}),n.addEventListener("keydown",n=>{"Enter"===n.key?(n.preventDefault(),t.click()):"Escape"===n.key&&(n.preventDefault(),e.click())})}_showConfirmModal(e){return new Promise(t=>{this._modalMode="confirm",this._modal.querySelector(".tf-modal-header").textContent="",this._modal.querySelector(".tf-modal-message").textContent=e,this._modal.querySelector(".tf-modal-input-wrapper").style.display="none",this._modal.style.display="block",this._modal._resolve=t})}_showInputModal(e,t="",n=""){return new Promise(o=>{this._modalMode="input";const i=this._modal.querySelector(".tf-modal-input");this._modal.querySelector(".tf-modal-header").textContent=e,this._modal.querySelector(".tf-modal-message").textContent="",this._modal.querySelector(".tf-modal-input-wrapper").style.display="block",i.placeholder=t,i.value=n,this._modal.style.display="block",this._modal._resolve=o,setTimeout(()=>{i.focus(),i.select()},100)})}_hideModal(e){this._modal.style.display="none";const t=this._modal.querySelector(".tf-modal-input");t&&(t.value=""),this._modal._resolve&&(this._modal._resolve(e),this._modal._resolve=null)}collapse(e){const n=t(this.data,e);"folder"===n?.type&&(n.collapsed=!0,this.refresh())}uncollapse(e){const n=t(this.data,e);"folder"===n?.type&&(n.collapsed=!1,this.refresh())}async open(e){const n=t(this.data,e);"file"===n?.type&&(this.onFileOpen(n),await this._openFileInEditor(e,n))}async _openFileInEditor(e,t){if(this.currentFile&&this.unsavedChanges.has(this.currentFile)){if(!await this._showConfirmModal("You have unsaved changes. Switch files anyway?"))return}this.currentFile=e;const n=await this._readFileContent(e,t);this.fileContents[e]=n;const{input:o,filename:i,unsavedIndicator:s,container:a}=this._editorElements;o.value=n,i&&(i.textContent=t.name),s&&(s.style.display=this.unsavedChanges.has(e)?"inline":"none"),a&&(a.style.display=this.editorConfig.useBuiltIn?"flex":"block")}async _readFileContent(e,t){return void 0!==this.fileContents[e]?this.fileContents[e]:this.hooks.onReadFile?await this.hooks.onReadFile(e,t):t.content||""}async _saveFileContent(e,n){if(this.hooks.onWriteFile){if(!await this.hooks.onWriteFile(e,n))return}else{const o=t(this.data,e);o&&(o.content=n)}this.fileContents[e]=n,this.unsavedChanges.delete(e);const{unsavedIndicator:o}=this._editorElements;o&&(o.style.display="none")}_closeEditor(){this.currentFile=null;const{input:e,filename:t,unsavedIndicator:n,container:o}=this._editorElements;o&&(o.style.display="none"),e.value="",t&&(t.textContent="No file selected"),n&&(n.style.display="none")}async refresh(){"api"===this.mode&&(this.data=await this.onLoad());let e=this.container.querySelector(".tf-tree-content");e||(e=document.createElement("div"),e.className="tf-tree-content",this.container.appendChild(e)),e.innerHTML=o(this.data,this.settings),this._attachEvents()}_getPath(e,t=""){return t?`${t}/${e.name}`:e.name}_findNode(e,t,n=""){const o=n?`${n}/${e.name}`:e.name;if(o===t)return e;if("folder"===e.type&&e.children)for(let n of e.children){const e=this._findNode(n,t,o);if(e)return e}return null}_removeNode(e,t,n=""){const o=n?`${n}/${e.name}`:e.name;if("folder"===e.type&&e.children){const n=e.children.findIndex(e=>`${o}/${e.name}`===t);if(-1!==n)return e.children.splice(n,1),!0;for(let n of e.children)if(this._removeNode(n,t,o))return!0}return!1}_attachEvents(){this.container.querySelectorAll(".tf-node").forEach(e=>{const n=e.dataset.path,o=t(this.data,n);e.onclick=async e=>{e.target.classList.contains("tf-action")||("folder"===o.type?(o.collapsed=!o.collapsed,this.refresh()):await this.open(n))};const i=e.querySelector(".tf-name-text");i&&(i.ondblclick=e=>{e.stopPropagation(),i.contentEditable=!0,i.focus();const t=document.createRange();t.selectNodeContents(i);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)},i.onblur=async n=>{i.contentEditable=!1;const s=i.textContent.trim();if(!s||s===o.name)return void this.refresh();const a=e.dataset.path.split("/");a.pop();if(((t(this.data,a.join("/"))||{children:this.data}).children||[]).some(e=>e.name===s))return alert("Name already exists"),void this.refresh();await this.renameNode(e.dataset.path,s)},i.onkeydown=e=>{"Enter"===e.key?(e.preventDefault(),i.blur()):"Escape"===e.key&&(i.contentEditable=!1,this.refresh())});const s=e.querySelector(".tf-action");s&&(s.onclick=e=>{e.stopPropagation(),this._showContextMenu(e,n)})}),this.container.addEventListener("contextmenu",e=>{e.preventDefault();const t=e.target.closest(".tf-node");t&&this._showContextMenu(e,t.dataset.path)})}_buildContextMenu(){this.menu=document.createElement("div"),this.menu.className="tf-context-menu",this.menu.style.display="none",document.body.appendChild(this.menu),["New File","New Folder","Rename","Delete"].forEach(e=>{const t=document.createElement("div");t.textContent=e,t.className="tf-context-item",t.dataset.action=e,t.addEventListener("click",async()=>await this._handleContextAction(e)),this.menu.appendChild(t)}),document.addEventListener("click",()=>this.menu.style.display="none")}_showContextMenu(e,n){this.selectedPath=n,this.menu.style.display="block",this.menu.style.left=e.pageX+"px",this.menu.style.top=e.pageY+"px";const o=t(this.data,n),i="file"===o?.type;this.menu.querySelectorAll(".tf-context-item").forEach(e=>{const t=e.dataset.action;"New File"!==t&&"New Folder"!==t||!i?e.classList.remove("disabled"):e.classList.add("disabled")})}async _handleContextAction(e){let n=this.selectedPath,o=t(this.data,n);switch(e){case"New File":{if("file"===o?.type){const e=n.split("/");e.pop(),n=e.join("/"),o=t(this.data,n)}if("file"===o?.type)break;const e=this.settings.newFilePrompt?this.settings.newFilePrompt():await this._showInputModal("Create New File","Enter file name...","newFile.js");e&&(this.settings.onCreateFile?this.settings.onCreateFile(n,e):this.createFile(n,e));break}case"New Folder":{if("file"===o?.type){const e=n.split("/");e.pop(),n=e.join("/"),o=t(this.data,n)}if("file"===o?.type)break;const e=this.settings.newFolderPrompt?this.settings.newFolderPrompt():await this._showInputModal("Create New Folder","Enter folder name...","newFolder");e&&(this.settings.onCreateFolder?this.settings.onCreateFolder(n,e):this.createFolder(n,e));break}case"Rename":{const e=document.querySelector(`.tf-node[data-path="${n}"]`);if(e){const t=e.querySelector(".tf-name-text");if(t){t.contentEditable=!0,t.focus();const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e)}}break}case"Delete":this._showConfirmModal(`Delete "${o?.name}"?`)&&(this.settings.onDelete?this.settings.onDelete(this.selectedPath):this.deleteNode(this.selectedPath));break}this.menu.style.display="none"}}const s={MINIMAL:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄"},colors:{folder:"cyan",file:"white"}},GITHUB:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂",js:"💛",json:"📋",md:"📝",css:"🎨",html:"🌐",image:"🖼️",video:"🎬",archive:"📦"},colors:{folder:"#0366d6",file:"#586069",open:"#0366d6",hover:"#f6f8fa",selected:"#e1e4e8"}},VSCODE_DARK:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂",js:"📜",ts:"🔷",json:"⚙️",md:"📝",css:"🎨",html:"🌐",git:"🔀"},colors:{folder:"#007acc",file:"#cccccc",open:"#0098ff",background:"#1e1e1e",hover:"#2a2d2e",selected:"#37373d",border:"#3c3c3c"}},VSCODE_LIGHT:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#007acc",file:"#383838",background:"#ffffff",hover:"#e8e8e8",selected:"#d4d4d4"}},COLORFUL:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂",code:"💻",image:"🖼️",doc:"📝",video:"🎬",audio:"🎵",archive:"📦",config:"⚙️"},colors:{folder:"#ff6b35",file:"#4ecdc4",open:"#95e1d3",code:"#6c5ce7",image:"#fd79a8",doc:"#fdcb6e"}},MATERIAL_DARK:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#82aaff",file:"#b0bec5",open:"#89ddff",background:"#263238",hover:"#2c3b41",selected:"#314549"}},MATERIAL_LIGHT:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#0277bd",file:"#546e7a",background:"#fafafa",hover:"#f5f5f5",selected:"#e0e0e0"}},ASCII:{asciiStyle:"ascii",indent:2,icons:{folder:"[+]",file:"[-]",open:"[-]"},colors:{folder:"green",file:"white",open:"lime"}},ASCII_COMPACT:{asciiStyle:"ascii",indent:1,icons:{folder:"+",file:"-",open:"-"},colors:{folder:"cyan",file:"gray"}},MONOCHROME:{asciiStyle:"unicode",indent:2,icons:{folder:"▶",file:"○",open:"▼"},colors:{folder:"#000000",file:"#666666",open:"#000000",background:"#ffffff",hover:"#f0f0f0",selected:"#e0e0e0"}},SOLARIZED_DARK:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#268bd2",file:"#839496",open:"#2aa198",background:"#002b36",hover:"#073642",selected:"#586e75"}},DRACULA:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#bd93f9",file:"#f8f8f2",open:"#8be9fd",background:"#282a36",hover:"#44475a",selected:"#6272a4"}},NORD:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#88c0d0",file:"#d8dee9",open:"#8fbcbb",background:"#2e3440",hover:"#3b4252",selected:"#4c566a"}},ONE_DARK:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#61afef",file:"#abb2bf",open:"#56b6c2",background:"#282c34",hover:"#2c323c",selected:"#3e4451"}},HIGH_CONTRAST:{asciiStyle:"unicode",indent:3,icons:{folder:"📁",file:"📄",open:"📂"},colors:{folder:"#0000ff",file:"#000000",open:"#0000ff",background:"#ffffff",hover:"#ffff00",selected:"#00ffff",border:"#000000"}}},a={MINIMAL:{settings:s.MINIMAL,features:{contextMenu:!1,dragDrop:!1,search:!1,keyboard:!0}},GITHUB_CLONE:{settings:s.GITHUB,features:{contextMenu:!0,dragDrop:!1,search:!0,keyboard:!0,filePreview:!0},contextMenuItems:["open","copy-path","download"],shortcuts:{"Ctrl+F":"search",Enter:"open-file",ArrowUp:"navigate-up",ArrowDown:"navigate-down"}},VSCODE_CLONE:{settings:s.VSCODE_DARK,features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!0,editor:!0,filePreview:!0},editorConfig:{useBuiltInEditor:!0,syntax:!0,autoSave:!0,tabSize:2},contextMenuItems:["new-file","new-folder","separator","rename","delete","separator","copy","paste","duplicate","separator","copy-path","copy-relative-path"],shortcuts:{"Ctrl+N":"new-file","Ctrl+Shift+N":"new-folder",F2:"rename",Delete:"delete","Ctrl+C":"copy","Ctrl+V":"paste","Ctrl+F":"search"}},FILE_MANAGER:{settings:s.MATERIAL_DARK,features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!0,multiSelect:!0,bulkOperations:!0,filePreview:!0,breadcrumbs:!0},contextMenuItems:["open","open-with","separator","new-file","new-folder","upload","separator","cut","copy","paste","duplicate","separator","rename","delete","separator","properties","share","compress"],toolbar:{enabled:!0,buttons:["new","upload","download","delete","refresh","view-options"]},shortcuts:{"Ctrl+N":"new-file","Ctrl+Shift+N":"new-folder","Ctrl+U":"upload",F2:"rename",Delete:"delete","Ctrl+A":"select-all","Ctrl+X":"cut","Ctrl+C":"copy","Ctrl+V":"paste","Ctrl+D":"duplicate",F5:"refresh"}},DOCS_BROWSER:{settings:{...s.GITHUB,icons:{folder:"📁",file:"📝",md:"📝",doc:"📘",pdf:"📕"}},features:{contextMenu:!0,dragDrop:!1,search:!0,keyboard:!0,filePreview:!0,tableOfContents:!0},contextMenuItems:["open","open-in-new-tab","separator","bookmark","print","share"],toolbar:{enabled:!0,buttons:["home","back","forward","search","bookmark","print"]},shortcuts:{"Ctrl+F":"search","Ctrl+B":"bookmark","Ctrl+P":"print","Alt+Left":"back","Alt+Right":"forward"}},MEDIA_BROWSER:{settings:{...s.COLORFUL,icons:{folder:"📁",file:"📄",image:"🖼️",video:"🎬",audio:"🎵",jpg:"🖼️",png:"🖼️",gif:"🖼️",mp4:"🎬",mp3:"🎵"}},features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!0,thumbnails:!0,gridView:!0,filePreview:!0},contextMenuItems:["open","preview","separator","download","share","separator","rename","move","delete","separator","properties"],viewOptions:{defaultView:"grid",thumbnailSize:"medium",showFileInfo:!0},shortcuts:{Space:"preview",Enter:"open",Delete:"delete","Ctrl+A":"select-all","Ctrl+D":"download"}},CODE_EDITOR:{settings:s.ONE_DARK,features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!0,editor:!0,syntaxHighlight:!0},editorConfig:{useBuiltInEditor:!0,syntax:!0,lineNumbers:!0,autoComplete:!0,autoSave:!0,tabSize:2,theme:"one-dark"},contextMenuItems:["new-file","new-folder","separator","rename","delete","separator","format","lint","separator","copy-path"],shortcuts:{"Ctrl+S":"save","Ctrl+N":"new-file","Ctrl+F":"find","Ctrl+H":"replace",F2:"rename","Alt+Shift+F":"format"}},TERMINAL_STYLE:{settings:s.ASCII,features:{contextMenu:!1,dragDrop:!1,search:!0,keyboard:!0},shortcuts:{"/":"search",h:"navigate-left",j:"navigate-down",k:"navigate-up",l:"navigate-right",Enter:"open"}},COMPACT:{settings:s.ASCII_COMPACT,features:{contextMenu:!0,dragDrop:!1,search:!0,keyboard:!0},display:{indent:1,fontSize:12,lineHeight:1.2,showFileExtension:!1}},ACCESSIBLE:{settings:s.HIGH_CONTRAST,features:{contextMenu:!0,dragDrop:!1,search:!0,keyboard:!0,screenReader:!0,focusIndicators:!0},accessibility:{ariaLabels:!0,keyboardNavigation:!0,highContrast:!0,focusVisible:!0,announceChanges:!0},shortcuts:{Tab:"next-item","Shift+Tab":"previous-item",Enter:"activate",Space:"select",ArrowDown:"next",ArrowUp:"previous",ArrowRight:"expand",ArrowLeft:"collapse"}},MOBILE_OPTIMIZED:{settings:s.MATERIAL_LIGHT,features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!1,touch:!0,swipeActions:!0},display:{indent:4,fontSize:16,touchTargetSize:44,compactMode:!0},gestures:{swipeLeft:"delete",swipeRight:"archive",longPress:"context-menu",doubleTap:"open"}},LARGE_DATASET:{settings:s.MINIMAL,features:{contextMenu:!0,dragDrop:!1,search:!0,keyboard:!0,virtualScroll:!0,lazyLoading:!0,pagination:!0},performance:{virtualScrolling:!0,lazyLoad:!0,cacheSize:1e3,renderBatchSize:50,debounceSearch:300},shortcuts:{"Ctrl+F":"search",PageDown:"page-down",PageUp:"page-up",Home:"go-top",End:"go-bottom"}},COLLABORATIVE:{settings:s.VSCODE_LIGHT,features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!0,presence:!0,liveUpdates:!0,comments:!0},collaboration:{showPresence:!0,showCursors:!0,enableComments:!0,enableChat:!0,conflictResolution:"last-write-wins"},contextMenuItems:["open","separator","share","invite","permissions","separator","comment","mention","separator","history","restore"]},READ_ONLY:{settings:s.GITHUB,features:{contextMenu:!0,dragDrop:!1,search:!0,keyboard:!0,editing:!1},contextMenuItems:["open","copy-path","download","share"],shortcuts:{"Ctrl+F":"search",Enter:"open","Ctrl+C":"copy-path"}},DRACULA_THEME:{settings:s.DRACULA,features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!0,editor:!0}},NORD_THEME:{settings:s.NORD,features:{contextMenu:!0,dragDrop:!0,search:!0,keyboard:!0,editor:!0}}};function r(e){const t=a[e];if(!t)throw new Error(`Preset "${e}" not found. Available: ${Object.keys(a).join(", ")}`);return JSON.parse(JSON.stringify(t))}const l={onCreateFile:e=>{const t=JSON.parse(localStorage.getItem("tree-files")||"{}");t[e]="",localStorage.setItem("tree-files",JSON.stringify(t))},onDeleteFile:e=>{const t=JSON.parse(localStorage.getItem("tree-files")||"{}");delete t[e],localStorage.setItem("tree-files",JSON.stringify(t))},onReadFile:e=>JSON.parse(localStorage.getItem("tree-files")||"{}")[e]||"",onWriteFile:(e,t)=>{const n=JSON.parse(localStorage.getItem("tree-files")||"{}");n[e]=t,localStorage.setItem("tree-files",JSON.stringify(n))}},d={onCreateFile:async e=>{await fetch("/api/files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e,type:"file"})})},onCreateFolder:async e=>{await fetch("/api/folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})})},onDeleteFile:async e=>{await fetch(`/api/files?path=${encodeURIComponent(e)}`,{method:"DELETE"})},onRenameNode:async(e,t)=>{await fetch("/api/rename",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPath:e,newPath:t})})},onReadFile:async e=>{const t=await fetch(`/api/files?path=${encodeURIComponent(e)}`);return await t.text()},onWriteFile:async(e,t)=>{await fetch("/api/files",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e,content:t})})},onLoad:async()=>{const e=await fetch("/api/tree");return await e.json()}},c={onCreateFile:e=>{console.log("📊 Analytics: File created",e)},onDeleteFile:e=>{console.log("📊 Analytics: File deleted",e)},onRenameNode:(e,t)=>{console.log("📊 Analytics: Node renamed",{oldPath:e,newPath:t})},onFileOpen:(e,t)=>{console.log("📊 Analytics: File opened",e,`(${t.length} bytes)`)}},f={onCreateFile:e=>{if(!e.includes("."))throw new Error("Files must have an extension");if(e.length>255)throw new Error("Path too long (max 255 characters)")},onRenameNode:(e,t)=>{if(t.includes(".."))throw new Error('Invalid path: cannot use ".."');const n=t.split("/").pop().toLowerCase();if(["con","prn","aux","nul"].includes(n))throw new Error("Forbidden filename")},onWriteFile:(e,t)=>{if(t.length>10485760)throw new Error("File too large (max 10MB)")}},h={cache:new Map,onReadFile:async function(e){if(this.cache.has(e))return console.log("📦 Cache hit:",e),this.cache.get(e);console.log("🌐 Cache miss, fetching:",e);const t=await fetch(`/api/files?path=${encodeURIComponent(e)}`),n=await t.text();return this.cache.set(e,n),n},onWriteFile:async function(e,t){this.cache.set(e,t),await fetch("/api/files",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e,content:t})})},onDeleteFile:function(e){this.cache.delete(e)},onRenameNode:function(e,t){this.cache.has(e)&&(this.cache.set(t,this.cache.get(e)),this.cache.delete(e))}},u={saveTimeout:null,onWriteFile:function(e,t){clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(async()=>{console.log("💾 Auto-saving:",e),await fetch("/api/files",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e,content:t})}),console.log("✅ Saved:",e)},1e3)}};const p={settings:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂",js:"📜",ts:"🔷",json:"⚙️",md:"📝",css:"🎨",html:"🌐"},colors:{folder:"#007acc",file:"#cccccc",open:"#0098ff",background:"#1e1e1e",hover:"#2a2d2e",selected:"#37373d",border:"#3c3c3c"}},editorConfig:{useBuiltInEditor:!0,inputId:"file-editor",filenameId:"editor-filename",saveButtonId:"save-btn",closeButtonId:"close-btn"}};function m(...e){const t={settings:{icons:{},colors:{}},editorConfig:{},hooks:{}};for(const n of e)n.settings&&(Object.assign(t.settings,n.settings),n.settings.icons&&Object.assign(t.settings.icons,n.settings.icons),n.settings.colors&&Object.assign(t.settings.colors,n.settings.colors)),n.editorConfig&&Object.assign(t.editorConfig,n.editorConfig),n.hooks&&Object.assign(t.hooks,n.hooks);return t}m(p,{hooks:{onCreateFile:e=>console.log("File created:",e)}});const g={containerId:null,localData:null,onLoad:null,settings:{asciiStyle:"unicode",indent:2,colors:{folder:"#0366d6",file:"#586069",open:"#0366d6",background:"#ffffff",hover:"#f6f8fa",selected:"#e1e4e8",border:"#e1e4e8"},icons:{folder:"📁",file:"📄",open:"📂"}},features:{contextMenu:!0,dragDrop:!1,search:!1,keyboard:!0,editor:!1,multiSelect:!1,virtualScroll:!1},editorConfig:{useBuiltInEditor:!1,inputId:null,filenameId:null,saveButtonId:null,closeButtonId:null},hooks:{},onFileOpen:null};function y(e,t){for(const n in t)t[n]&&"object"==typeof t[n]&&!Array.isArray(t[n])?(e[n]||(e[n]={}),y(e[n],t[n])):e[n]=t[n]}e.AnalyticsHooks=c,e.AutoSaveHooks=u,e.CacheHooks=h,e.ConfigPresets=a,e.DEFAULT_CONFIG=g,e.DocsBrowserConfig={settings:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",md:"📝",doc:"📝"},colors:{folder:"#0366d6",file:"#586069",background:"#f6f8fa"}},editorConfig:{useBuiltInEditor:!1}},e.EditorConfigReference={useBuiltInEditor:!0,inputId:"file-editor",filenameId:"editor-filename",saveButtonId:"save-btn",closeButtonId:"close-btn",customEditor:null},e.FileManagerConfig={settings:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂",js:"💛",json:"📋",md:"📝",css:"🎨",html:"🌐"},colors:{folder:"#0366d6",file:"#586069",hover:"#f6f8fa",selected:"#e1e4e8"}},editorConfig:{useBuiltInEditor:!0,inputId:"file-editor",filenameId:"editor-filename",saveButtonId:"save-btn",closeButtonId:"close-btn"}},e.GitHubCloneConfig={settings:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄",open:"📂",js:"📜",json:"⚙️",md:"📝",git:"🔀"},colors:{folder:"#0366d6",file:"#586069",open:"#0366d6",background:"#ffffff",hover:"#f6f8fa",selected:"#e1e4e8",border:"#e1e4e8"}}},e.LocalStorageHooks=l,e.RestApiHooks=d,e.SettingsReference={asciiStyle:"unicode",indent:2,colors:{folder:"#0366d6",file:"#586069",open:"#0366d6",background:"#ffffff",hover:"#f6f8fa",selected:"#e1e4e8",border:"#e1e4e8"},icons:{folder:"📁",file:"📄",open:"📂",js:"💛",ts:"🔷",json:"📋",md:"📝",css:"🎨",html:"🌐",image:"🖼️",video:"🎬",audio:"🎵",archive:"📦",config:"⚙️",git:"🔀",lock:"🔒",code:"💻",doc:"📝"}},e.SimpleTreeConfig={settings:{asciiStyle:"unicode",indent:2,icons:{folder:"📁",file:"📄"},colors:{folder:"cyan",file:"white"}}},e.TerminalConfig={settings:{asciiStyle:"ascii",indent:2,icons:{folder:"[+]",file:"[-]",open:"[-]"},colors:{folder:"green",file:"white",open:"lime",background:"black"}}},e.TreeDataStructure={name:"src",type:"folder",children:[],id:"unique-id",path:"path/to/node",size:1024,modified:"2024-01-01",permissions:"rw-r--r--",icon:"📁",color:"#0366d6",metadata:{}},e.TreeForge=i,e.TreeStyles=s,e.VSCodeCloneConfig=p,e.ValidationHooks=f,e.combineHooks=function(...e){const t={};for(const n of e)for(const[e,o]of Object.entries(n))if(t[e]){const n=t[e];t[e]=async(...e)=>{await n(...e),await o(...e)}}else t[e]=o;return t},e.createConfig=m,e.createFromPreset=function(e,t={}){const{ConfigPresets:n}=require("./config-presets.js"),o=n[e];if(!o)throw new Error(`Preset "${e}" not found`);const i=JSON.parse(JSON.stringify(o));return y(i,t),i},e.default=i,e.getConfigHelp=function(e=null){const t={settings:"\nSettings Configuration:\n- asciiStyle: 'unicode' or 'ascii' (tree line style)\n- indent: number (spaces per level)\n- colors: object (color scheme)\n- icons: object (icon mappings)\n\nExample:\nsettings: {\n  asciiStyle: 'unicode',\n  indent: 2,\n  colors: { folder: '#0366d6', file: '#586069' },\n  icons: { folder: '📁', file: '📄' }\n}\n\t\t".trim(),hooks:"\nHooks Configuration:\nAvailable hooks:\n- onCreateFile(path, parentNode)\n- onCreateFolder(path, parentNode)\n- onDeleteFile(path, node)\n- onDeleteFolder(path, node)\n- onDeleteNode(path, node)\n- onRenameNode(oldPath, newPath, node)\n- onReadFile(path, node)\n- onWriteFile(path, content, node)\n- onLoad()\n- onFileOpen(path, content, node)\n\nAll hooks support async/await.\n\nExample:\nhooks: {\n  onReadFile: async (path) => {\n    const response = await fetch(`/api/files?path=${path}`);\n    return await response.text();\n  }\n}\n\t\t".trim(),features:"\nFeatures Configuration:\n- contextMenu: boolean (right-click menu)\n- dragDrop: boolean (drag and drop support)\n- search: boolean (search functionality)\n- keyboard: boolean (keyboard shortcuts)\n- editor: boolean (file editor)\n- multiSelect: boolean (select multiple items)\n- virtualScroll: boolean (virtual scrolling for large trees)\n\nExample:\nfeatures: {\n  contextMenu: true,\n  dragDrop: true,\n  search: true,\n  keyboard: true\n}\n\t\t".trim(),editorConfig:"\nEditor Configuration:\n- useBuiltInEditor: boolean (use built-in editor)\n- inputId: string (textarea element ID)\n- filenameId: string (filename display element ID)\n- saveButtonId: string (save button ID)\n- closeButtonId: string (close button ID)\n- customEditor: function (custom editor function)\n\nExample:\neditorConfig: {\n  useBuiltInEditor: true,\n  inputId: 'file-editor',\n  filenameId: 'editor-filename',\n  saveButtonId: 'save-btn',\n  closeButtonId: 'close-btn'\n}\n\t\t".trim()};return e?t[e]||`No help available for section: ${e}`:Object.entries(t).map(([e,t])=>`${e.toUpperCase()}:\n${t}`).join("\n\n")},e.getPreset=r,e.listPresets=function(){return Object.keys(a)},e.mergePresets=function(...e){const t={settings:{},features:{},contextMenuItems:[],shortcuts:{}};for(const n of e){const e=r(n);Object.assign(t.settings,e.settings),Object.assign(t.features,e.features),Object.assign(t.shortcuts,e.shortcuts),e.contextMenuItems&&t.contextMenuItems.push(...e.contextMenuItems)}return t},e.processConfig=function(e){const t=JSON.parse(JSON.stringify(g));return y(t,e),t},e.validateConfig=function(e){const t=[];if(e.containerId||t.push("containerId is required"),e.localData||e.onLoad||t.push("Either localData or onLoad must be provided"),e.settings&&(e.settings.asciiStyle&&!["unicode","ascii"].includes(e.settings.asciiStyle)&&t.push('asciiStyle must be "unicode" or "ascii"'),e.settings.indent&&"number"!=typeof e.settings.indent&&t.push("indent must be a number")),e.editorConfig&&e.editorConfig.useBuiltInEditor){const n=["inputId","filenameId","saveButtonId","closeButtonId"];for(const o of n)e.editorConfig[o]||t.push(`editorConfig.${o} is required when using built-in editor`)}return t},Object.defineProperty(e,"__esModule",{value:!0})});
